package com.soywiz.korlibs.api.service

import com.soywiz.kminiorm.*
import com.soywiz.kminiorm.memory.*
import com.soywiz.korinject.*
import com.soywiz.korio.async.*
import io.mockk.*
import kotlin.test.*

class BintrayTest {
	@Test
	fun testGetLibraryVersion() = suspendTest {
		val injector = AsyncInjector().jvmAutomapping()
		injector.mapInstance<Db>(MemoryDb())
		val client = mockk<SimpleHttpClient>()
		coEvery { client.getString(any()) } returns """{"name":"korge","repo":"korlibs","owner":"korlibs","desc":"KorGE Game Engine. Kotlin Game Engine for Multiplatform Kotlin 1.3","labels":[],"licenses":["MIT"],"custom_licenses":[],"followers_count":1,"created":"2019-11-01T09:40:04.960Z","website_url":"https://korlibs.soywiz.com/korge","issue_tracker_url":"https://github.com/korlibs/korge/issues","linked_to_repos":[],"permissions":[],"versions":["2.0.3","2.0.2","2.0.1","2.0.0","2.0.0-rc3","2.0.0-rc2","korge-spine-iosx64","korge-spine-iosarm64","korge-spine-mingwx64","korge-spine-linuxx64","korge-spine-android","korge-spine-js","korge-spine-macosx64","2.0.0-alpha","korge-spine","korge-spine-iosarm32","korge-spine-jvm","korge-spine-metadata","1.15.1","1.15.0","1.14.0","1.13.12","1.13.11","1.13.10","1.13.9","1.13.8","1.13.5","1.13.4","1.13.3","1.13.2","1.13.1","1.13.0","1.12.15","1.12.14","1.12.13","1.12.12","1.12.10","1.12.9","1.12.8","1.12.7","1.12.6","1.12.4","1.12.3","1.12.2","1.12.1","1.12.0","1.11.3","korge-swf","korge-dragonbones-metadata","korge-dragonbones-js","korge-dragonbones","korge-dragonbones-android","korge-box2d","korge-box2d-jvm","korge-admob-linuxx64","korge-box2d-js","korge-metadata","korge-jvm","korge-js","1.11.2","korge-box2d-metadata","korge-swf-android","korge-box2d-mingwx64","korge-iosarm64","korge-dragonbones-jvm","korge-swf-linuxx64","korge-admob-macosx64","korge-box2d-macosx64","korge-swf-mingwx64","korge-box2d-iosarm32","korge-swf-iosarm64","korge-iosx64","korge-dragonbones-mingwx64","korge","korge-box2d-iosx64","korge-swf-jvm","korge-swf-metadata","korge-admob-iosarm32","korge-dragonbones-macosx64","korge-admob-iosx64","korge-box2d-android","korge-box2d-linuxx64","korge-admob-mingwx64","korge-swf-iosx64","korge-swf-macosx64","korge-admob-iosarm64","korge-linuxx64","korge-admob-js","korge-dragonbones-linuxx64","korge-swf-iosarm32","korge-mingwx64","korge-dragonbones-iosx64","korge-admob-android","korge-box2d-iosarm64","korge-dragonbones-iosarm64","korge-dragonbones-iosarm32","korge-android","korge-admob-metadata","korge-macosx64","korge-admob","korge-admob-jvm","korge-swf-js","korge-iosarm32","1.11.1","1.11.0","1.10.2","1.10.0","1.5.7","1.5.6","1.5.5","1.5.4","1.5.0c","1.5.1","1.4.3c","1.4.3b","1.4.3","1.4.2","1.4.1","1.4.0e","1.4.0d","1.4.0c","1.4.0b","1.4.0","1.3.0"],"latest_version":"2.0.3","updated":"2020-12-26T13:16:18.344Z","rating_count":0,"system_ids":["com.soywiz.korlibs.korge:korge-swf-linuxx64","com.soywiz.korlibs.korge:korge-3d-iosx64","com.soywiz.korlibs.korge:korge-jvm","com.soywiz.korlibs.korge:korge-dragonbones-linuxx64","com.soywiz.korlibs.korge:korge-dragonbones-iosarm64","com.soywiz.korlibs.korge:korge-3d-android","com.soywiz.korlibs.korge:korge-dragonbones","com.soywiz.korlibs.korge:korge-box2d-mingwx64","com.soywiz.korlibs.korge:korge-dragonbones-macosx64","com.soywiz.korlibs.korge:korge-dragonbones-metadata","com.soywiz.korlibs.korge:korge-iosx64","com.soywiz.korlibs.korge:korge-3d-iosarm64","com.soywiz.korlibs.korge:korge-dragonbones-jvm","com.soywiz.korlibs.korge:korge-dragonbones-js","com.soywiz.korlibs.korge:korge-dragonbones-iosx64","com.soywiz.korlibs.korge:korge-box2d-iosx64","com.soywiz.korlibs.korge:korge-dragonbones-iosarm32","com.soywiz.korlibs.korge:korge-box2d-iosarm64","com.soywiz.korlibs.korge:korge-dragonbones-android","com.soywiz.korlibs.korge:korge-box2d-metadata","com.soywiz.korlibs.korge:korge-box2d-macosx64","com.soywiz.korlibs.korge:korge-box2d","com.soywiz.korlibs.korge:korge-box2d-jvm","com.soywiz.korlibs.korge:korge-box2d-js","com.soywiz.korlibs.korge:korge-box2d-iosarm32","com.soywiz.korlibs.korge:korge-box2d-android","com.soywiz.korlibs.korge:korge-3d-metadata","com.soywiz.korlibs.korge:korge-3d-macosx64","com.soywiz.korlibs.korge:korge-3d","com.soywiz.korlibs.korge:korge-3d-jvm","com.soywiz.korlibs.korge:korge-3d-js","com.soywiz.korlibs.korge:korge-android","com.soywiz.korlibs.korge:korge-3d-iosarm32","com.soywiz.korlibs.korge.plugins:korge-build","com.soywiz.korlibs.korge.plugins:korge-gradle-plugin","com.soywiz.korlibs.korge.plugins:korge-jvm-bundle","com.soywiz.korlibs.korge:korge-mingwx64","com.soywiz.korlibs.korge:korge-3d-mingwx64","com.soywiz.korlibs.korge:korge-dragonbones-mingwx64","com.soywiz.korlibs.korge:korge-swf-mingwx64","com.soywiz.korlibs.korge:korge-iosarm32","com.soywiz.korlibs.korge:korge-iosarm64","com.soywiz.korlibs.korge:korge-js","com.soywiz.korlibs.korge:korge","com.soywiz.korlibs.korge:korge-macosx64","com.soywiz.korlibs.korge:korge-metadata","com.soywiz.korlibs.korge:korge-box2d-linuxx64","com.soywiz.korlibs.korge:korge-3d-linuxx64","com.soywiz.korlibs.korge:korge-linuxx64","com.soywiz.korlibs.korge:korge-swf-android","com.soywiz.korlibs.korge:korge-swf-iosarm32","com.soywiz.korlibs.korge:korge-swf-iosarm64","com.soywiz.korlibs.korge:korge-swf-iosx64","com.soywiz.korlibs.korge:korge-swf-js","com.soywiz.korlibs.korge:korge-swf-jvm","com.soywiz.korlibs.korge:korge-swf","com.soywiz.korlibs.korge:korge-swf-macosx64","com.soywiz.korlibs.korge:korge-swf-metadata","com.soywiz.korlibs.korge:korge-admob-mingwx64","com.soywiz.korlibs.korge:korge-admob-iosarm32","com.soywiz.korlibs.korge:korge-admob-iosarm64","com.soywiz.korlibs.korge:korge-admob-iosx64","com.soywiz.korlibs.korge:korge-admob-js","com.soywiz.korlibs.korge:korge-admob-jvm","com.soywiz.korlibs.korge:korge-admob","com.soywiz.korlibs.korge:korge-admob-macosx64","com.soywiz.korlibs.korge:korge-admob-metadata","com.soywiz.korlibs.korge:korge-admob-android","com.soywiz.korlibs.korge:korge-admob-linuxx64","com.soywiz.korlibs.korge:korge-billing","com.soywiz.korlibs.korge:korge-billing-mingwx64","com.soywiz.korlibs.korge:korge-services","com.soywiz.korlibs.korge:korge-spine","com.soywiz.korlibs.korge:korge-billing-linuxx64","com.soywiz.korlibs.korge:korge-services-linuxx64","com.soywiz.korlibs.korge:korge-spine-linuxx64","com.soywiz.korlibs.korge:korge-billing-iosarm32","com.soywiz.korlibs.korge:korge-billing-android","com.soywiz.korlibs.korge:korge-billing-iosarm64","com.soywiz.korlibs.korge:korge-billing-iosx64","com.soywiz.korlibs.korge:korge-billing-js","com.soywiz.korlibs.korge:korge-billing-jvm","com.soywiz.korlibs.korge:korge-billing-macosx64","com.soywiz.korlibs.korge:korge-billing-metadata","com.soywiz.korlibs.korge:korge-services-mingwx64","com.soywiz.korlibs.korge:korge-spine-mingwx64","com.soywiz.korlibs.korge:korge-services-iosx64","com.soywiz.korlibs.korge:korge-services-android","com.soywiz.korlibs.korge:korge-services-iosarm32","com.soywiz.korlibs.korge:korge-services-macosx64","com.soywiz.korlibs.korge:korge-services-iosarm64","com.soywiz.korlibs.korge:korge-services-js","com.soywiz.korlibs.korge:korge-services-jvm","com.soywiz.korlibs.korge:korge-services-metadata","com.soywiz.korlibs.korge:korge-spine-android","com.soywiz.korlibs.korge:korge-spine-iosarm32","com.soywiz.korlibs.korge:korge-spine-iosarm64","com.soywiz.korlibs.korge:korge-spine-iosx64","com.soywiz.korlibs.korge:korge-spine-js","com.soywiz.korlibs.korge:korge-spine-jvm","com.soywiz.korlibs.korge:korge-spine-macosx64","com.soywiz.korlibs.korge:korge-spine-metadata"],"vcs_url":"https://github.com/korlibs/korgw/issues","maturity":"Stable","attributes":{"maturity":["Stable"]}}"""
		injector.mapInstance(client)
		val bintray = injector.get<Bintray>()
		assertEquals("2.0.3", bintray.getLibraryVersion("korge"))
		coVerify { client.getString(any()) }
	}
}